### 登录

1.实例化设备

上传：设备类型，APP版本...

返回：设备id,以及token

服务器创建设备对应相关的信息

2.账户注册

上传：设备id，token，账户，密码

返回：是否注册成功，若注册成功，执行步骤3，直接登录

服务器创建账户信息

2.账户登录

上传：设备id，token，账户，密码

返回：验证结果

服务器记录，创建账户与设备的对应信息

### TCP登录

只需设备上线，将TCP连接与设备绑定

### 用户上线触发消息同步

1.发送自己本地对应的序号

2.服务器根据客户端本地的序号，返回给用户的消息

3.用户回执消息已经接收

### 消息发送给单个客户

1.客户端将消息发送到Connect，Connect回执客户端发送成功，并将消息发到Logic

2.Logic将消息写入kafka,并且发送到对应的Connect，Connect发送到相应的客户端

3.客户端收到消息之后，回执服务器，服务器在kafka中删除对应的消息

### 消息发送给群组

1.客户端将消息发送到Connect，Connect回执客户端发送成功，并将消息发到Logic

2.Logic将消息写入kafka,并且发送到对应的Connect，Connect发送到相应的客户端

3.客户端收到消息之后，回执服务器，服务器在kafka中删除对应的消息

### 协议

1.数据字段

数据序号，

### 消息持久化选型

kafka   

1.生产者异步存储，延时较高，可能拉不到数据

2.消息持久化存储，大部分消息存储时间为几毫秒，而且消息量级比较大，磁盘读写太过于频繁

​            